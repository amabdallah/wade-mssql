USE [WaDE_Oct2014]
GO

/****** Object:  UserDefinedFunction [wade_r].[DataTypeCatalog]    Script Date: 8/15/2016 11:20:33 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


CREATE FUNCTION [wade_r].[DataTypeCatalog](@orgid varchar(10), @reportid varchar(35), @datacategory varchar(7), @loctype varchar(max), @loctxt varchar(max))
  RETURNS xml

BEGIN
--BEGIN FUNCTION

DECLARE @tmp XML='';

IF @loctype='HUC'

BEGIN
--BEGIN HUC

WITH XMLNAMESPACES('ReplaceMe' AS WC)

SELECT @tmp=(SELECT DATATYPE AS 'WC:DataType'
	
	FROM 
	
	WADE_R.CATALOG_SUMMARY B WHERE B.ORGANIZATION_ID=@orgid AND B.REPORT_ID=@reportid 
	AND DATACATEGORY=@datacategory AND B.HUC=@loctxt GROUP BY DATATYPE FOR XML PATH (''));
	
END
--END HUC

IF @loctype='COUNTY'
BEGIN
--BEGIN COUNTY

WITH XMLNAMESPACES('ReplaceMe' AS WC)

SELECT @tmp=(SELECT DATATYPE AS 'WC:DataType'
	
	FROM 
	
	WADE_R.CATALOG_SUMMARY B WHERE B.ORGANIZATION_ID=@orgid AND B.REPORT_ID=@reportid 
	AND DATACATEGORY=@datacategory AND B.COUNTY_FIPS=@loctxt GROUP BY DATATYPE FOR XML PATH (''));
	
END
--END COUNTY

IF @loctype='REPORTUNIT'
BEGIN
--BEGIN REPORTUNIT

WITH XMLNAMESPACES('ReplaceMe' AS WC)

SELECT @tmp=(SELECT DATATYPE AS 'WC:DataType'
	
	FROM 
	
	WADE_R.CATALOG_SUMMARY B WHERE B.ORGANIZATION_ID=@orgid AND B.REPORT_ID=@reportid 
	AND DATACATEGORY=@datacategory AND B.REPORT_UNIT_ID=@loctxt GROUP BY DATATYPE FOR XML PATH (''));
	
END
--END REPORTUNIT
If (@tmp IS NOT NULL)
BEGIN
WITH XMLNAMESPACES ('ReplaceMe' AS WC)
SELECT @tmp=(SELECT @tmp FOR XML PATH('WC:DataTypes'));
END	
RETURN (@tmp)
		
END



GO


